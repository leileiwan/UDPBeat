# 1. 背景
* 使用udp还是tcp
* 是client发送还是tcp发送

# 2. 调研
## 2.1 使用tcp还是udp
### 2.1.1 tcp 优点
* tcp 窗口机制能有效防止网络拥塞

### 2.1.2 udp 优点
* udp心跳需要开销小（tcp连接会吃更多资源）
* tcp 三次握手也会增加网络负担
* udp 头部数据开销小

### 2.1.3 结论
由于心跳包都很小，连接时间段，更适合使用udp做心跳。



## 2.2. 客户端发送还是服务端发送心跳
### 2.2.1 客户端发送心跳的优点
* 被动接受能减少网络包的发送
* 被动接受不需要动态添加pod 配置文件信息
* 客户端方便设置timeout方便设置心跳评率
* 服务端不需要每次发送心跳都开一个携程，频繁的携程创建和回收也会吃更多资源

### 2.2.2 服务端发送心跳包优点
* 客户端不需要知道服务端地址和心跳频率，用户完全不敢知心跳的存在
* 这样服务端可以并发启动很多进程，反之只有一个服务进程在listen

### 2.2.3 结论
使用客户端发送心跳方式，速度改进见第4点

## 2.3. 速度问题
* 使用队列：服务端获取到消息后先入队，然后使用多个消费者去消费队列中的数据

## 2.4 消息校验
* 降低中间人攻击的风险


# 3.使用
* 下载
```
go get github.com/leileiwan/sense-beat/...
```

* 编译
```
cd github.com/leileiwan/sense-beat
make
```

* 运行
    * server
    ```
    ./sense-beat.server.v1
    ```
    * client
    ```
    ./sense-beat.client.v1
    ```
* clean
```
make clean
```

# 4. 测试
* 包含单元测试和集成测试
```
make test
```